___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "CLIENT",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Scoby Analytics",
  "categories": ["ANALYTICS"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAylpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDkuMC1jMDAxIDc5LmMwMjA0YjJkZWYsIDIwMjMvMDIvMDItMTI6MTQ6MjQgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCAyNC4zIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjZBMzAzRDA3Q0NENTExRUQ5MzZGOEVGNzQ4OTVCMTMzIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjZBMzAzRDA4Q0NENTExRUQ5MzZGOEVGNzQ4OTVCMTMzIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NkEzMDNEMDVDQ0Q1MTFFRDkzNkY4RUY3NDg5NUIxMzMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NkEzMDNEMDZDQ0Q1MTFFRDkzNkY4RUY3NDg5NUIxMzMiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7V0pGyAAAcvUlEQVR4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\u003d\u003d"
  },
  "description": "Send your PageViews to Scoby Analytics.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "apiKey",
    "displayName": "API Key",
    "simpleValueType": true,
    "help": "Please find your API key in your workspace\u0027s settings on https://app.scoby.io"
  },
  {
    "type": "TEXT",
    "name": "salt",
    "displayName": "Secret Salt",
    "simpleValueType": true,
    "help": "The salt helps to anonymize your traffic before it is sent to our servers. It must be an alphanumeric string of at least 32 characters. You can generate one on e.g. https://onlinetools.com/random/generate-random-string"
  },
  {
    "type": "TEXT",
    "name": "endpoint",
    "displayName": "Endpoint",
    "simpleValueType": true,
    "help": "The Endpoint specifies the path on your SGTM on which Scoby Analytics receives its data. You can freely choose any name except \"scoby\".",
    "defaultValue": "/count"
  }
]


___SANDBOXED_JS_FOR_SERVER___

const getRequestPath = require('getRequestPath');
const claimRequest = require('claimRequest');
const getRequestHeader = require('getRequestHeader');
const getRemoteAddress = require('getRemoteAddress');
const getRequestQueryParameter = require('getRequestQueryParameter');
const sha256Sync = require('sha256Sync');
const fromBase64 = require('fromBase64');
const sendHttpGet = require('sendHttpGet');
const parseUrl = require('parseUrl');
const encodeUriComponent = require('encodeUriComponent');

const logToConsole = require('logToConsole');

const returnResponse = require('returnResponse');
const setResponseStatus = require('setResponseStatus');
const setResponseBody = require('setResponseBody');

const boom = (statusCode, message) => {
  setResponseStatus(statusCode);
  setResponseBody(message);
  returnResponse();
};

function getSalt() {
  return data.salt;
}

function getAppId() {
  return fromBase64(data.apiKey).split('|')[0];
}

function getWriteKey() {
  return fromBase64(data.apiKey).split('|')[1];
}

function getApiKey() {
  return 'Bearer ' + getWriteKey();
}

function getReferringUrl() {
  const ref = parseUrl(getRequestQueryParameter('ref'));
  if(ref) {
    return ref.origin;
  }
}

function getUserAgent() {
  return getRequestHeader('user-agent');
}

function getIpAddress() {
  return getRemoteAddress();
}

function getRequestedUrl() {
  logToConsole(getRequestQueryParameter('url'));
 
  const url = parseUrl(getRequestQueryParameter('url')) || {searchParams: {}};
  const queryParams = [];
  
  for(const param in ['utm_source', 'utm_medium', 'utm_campaign', 'utm_term', 'utm_content']) {
    if(url.searchParams[param]) {
      queryParams.push(param + '=' + encodeUriComponent(url.searchParams[param]));
    }
  }
    
  return url.origin + '?' + queryParams.join('&');
}

function getVisitorId() {

  return sha256Sync([
    getIpAddress(), 
    getUserAgent(), 
    getAppId(), 
    getSalt()
  ].join('|'), {outputEncoding: 'hex'});
  
}

if (getRequestPath() === data.endpoint) {

  claimRequest();
  
  const userAgent = getUserAgent();
  const visitorId = getVisitorId();
  const requestedUrl = getRequestedUrl();
  const referringUrl = getReferringUrl();
  
  const params = [];
  params.push('vid=' + encodeUriComponent(visitorId));
  params.push('ua=' + encodeUriComponent(userAgent));
  params.push('url=' + encodeUriComponent(requestedUrl));
  params.push('ref=' + encodeUriComponent(referringUrl));

  const url = 'https://' + getAppId() + '.s3y.io/count?' + params.join('&');
  logToConsole("url", url);
  
  sendHttpGet(url, {
    headers: {
      Authorization: getApiKey()
    },
    timeout: 5000,
  });
    
  boom(204, 'No Content');  
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "queryParametersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "remoteAddressAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "pathAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "queryParameter"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "url"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "queryParameter"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ref"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "return_response",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_response",
        "versionId": "1"
      },
      "param": [
        {
          "key": "writeResponseAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "writeStatusAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "writeBodyAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "writeHeaderAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.s3y.io/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 3.7.2023, 19:05:26


